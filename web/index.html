<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <!-- Bootstrap CSS -->

<!--    <link href="css/bootstrap.css">-->

    <!-- Favicon codes generated by https://realfavicongenerator.net/ -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <title>Hash Hunt!</title>
</head>


<style>

    .kenocell {
        padding: 10px 25px;
        margin: 15px;
        text-align: center;
        border-style: solid;
        border-width: 1px;
        cursor: pointer;
        user-select: none;
    }

    .kenocell_selected {
        background: #a52834;
    }

    .wheelscell {
        padding: 10px 20px;
        text-align: center;
        border-style: solid;
        border-width: 1px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.5em;
    }

    @keyframes you_win_cell {
        0% {

        }

        100% {
            transform: scale(1.2);
            background: chartreuse;
        }
    }

    @keyframes you_win_text {
        0% {

        }

        50% {
        }

        100% {
            transform: scale(2);
        }
    }


    .wheelscell_winner_cell {
        animation-name: you_win_cell;
        animation-duration: 0.2s;
        animation-iteration-count: infinite;
        animation-direction: alternate;
    }

    .wheelscell_winner_text {
        animation-name: you_win_cell;
        animation-duration: 0.5s;
        animation-iteration-count: infinite;
        animation-direction: alternate;
    }


</style>
<body>
<h1>First one to find all the hashes wins 5 bitcoin.</h1>
<h2>Guaranteed winner in each round.</h2>

<table id="wheelsTable">
</table>

<!-- Import a clean, no-dependency sha256 function -->
<!-- Note I removed the `export` line at the end to avoid modules. -->
<script  src="js/sha256.js" ></script>


<div id="in" style="font-family: 'Courier New',monospace" >NOT SET YET</div>
<div id="out" style="font-family: 'Courier New',monospace">NOT SET YET</div>

<!-- Option 1: Bootstrap Bundle with Popper -->
<!--<script src="js/bootstrap.bundle.js"></script>-->


<table id="kenotable"></table>


<script>

    // Number of leading 0's we need to get to win
    var difficulty = 20;

    // Quick access to the textContent of the cells.
    var wheelstablecells = [];

    // Set wheel w to the given value. 0=Bitcoin, others=fruits
    function setWheel(w,v) {

        let cell = wheelstablecells[w];

        let t;

        if (v===0) {             // Winning wheel?
            t = "#";             // The magic hash
            cell.classList.add( "wheelscell_winner_cell");
        } else {
           t =  "&#" + (127811+v) +";";  // Fruits
           cell.classList.remove( "wheelscell_winner_cell");
        }

        cell.innerHTML = t;
        //console.log( "wheel="+w+" t="+t + "v=" +v);
    }

    // Set all the wheels according to the leading bytes of v
    function setwheels(v) {
        for( let i=0; i<difficulty;i++ ) {
            setWheel(i, Number.parseInt( v[i] , 16  ) );
        }

    }

    // We want this to be static so we use `var` on purpose
    var bits=[];

    function toBin( b ) {
        // (bit >>> 0 ) explained at https://stackoverflow.com/a/16155417/3152071

        let s="";
        for( let i =0 ; i< bits.length; i++ ) {
            s = ( b[i] ? "1":"0" ) + s;
        }
        return s;
    }

    function clickHandler(cell,bit) {

        console.log("clickhandler cell="+cell+" bit="+bit+" bits="+ toBin(bits) );

        if (bits[bit]) {
            cell.classList.remove("kenocell_selected");
            bits[bit]=false;
        } else {
            cell.classList.add("kenocell_selected");
            bits [bit]=true;
        }
        document.getElementById("in").textContent = toBin(bits);
        var hasstr = "X"+toBin(bits)
        //hasstr = "abc";
        var out = Sha256.hash(Sha256.hash( hasstr ));
        //console.log( "hex="+ hasstr +" out="+out);
        document.getElementById("out").textContent = out;

        setwheels(out);
    }

    let wheelstable = document.getElementById("wheelsTable");
    let cell_index=0;
    for(let row_index=0; row_index<2;row_index++) {
        let row = wheelstable.insertRow();
        for (let col_index = 0; col_index < (difficulty/2); col_index++) {
            let cell = row.insertCell();
            wheelstablecells[cell_index] = cell;
            cell.classList.add("wheelscell");
            cell.appendChild(document.createTextNode("❓"));    // Question mark
            cell_index++;
            //console.log("index="+cell_index+" row="+row_index+" col="+col_index)
        }
    }

    function onmousedownhandler(e,c,b) {
        clickHandler( c , b  );
    };

    function onmouseenterhander(e,c,b) {
        if (e.buttons & 0x01) clickHandler( c, b )
    };


    let bit_index =0;
    let kenotable = document.getElementById("kenotable");
    for(let row_index=0; row_index<10;row_index++) {
        let row = kenotable.insertRow();
        for( let col_index=0; col_index<8;col_index++) {
            let cell = row.insertCell();
            cell.classList.add("kenocell");
            let text = document.createTextNode( " " +  (bit_index+1));
            cell.appendChild(text);
            let tempvalue_of_bit_index = bit_index;
            cell.onmousedown = function () {clickHandler( cell ,  tempvalue_of_bit_index   )};
            cell.onmouseenter = function (e) { if (e.buttons & 0x01) clickHandler( cell ,tempvalue_of_bit_index  ) };
            bits[bit_index]=0;
            bit_index++;
            //console.log("bi="+bit_index);
        }
    }
</script>


<script src="js/bitcoinjs.min.js">
    // This is a Browserfy'ed version of the popular bitcoinjs package.
    // To verify it is trustworthy for yourself, check out ./js/bitcoinjs.MD
</script>
<script>
    const TESTNET = bitcoinjs.networks.testnet;
    const MAINNET = bitcoinjs.networks.main;

    const network = MAINNET;
    const keyPair = bitcoinjs.ECPair.makeRandom();
    const address1  = bitcoinjs.payments.p2pkh({ pubkey: keyPair.publicKey ,  network: TESTNET  }).address;
    const pubkey = keyPair.publicKey;
    const privateKey = keyPair.privateKey;
    const wif = keyPair.toWIF();
    console.log(pubkey);
    console.log(address1);
    console.log(wif);


    // Lets make a block
    // https://github.com/bitcoinjs/bitcoinjs-lib/blob/master/ts_src/block.ts

    let block= new bitcoinjs.Block();        // Set up all the fields

    // https://developer.bitcoin.org/reference/block_chain.html

    // Lets try this first
    // https://www.blockchain.com/btc/block/000000000000000000039f8b1a2c48ee1dacd581e7cacb560e75d8de051cc0e1
    block.version = Number.parseInt( "2000e000" , 16 );


    block.prevHash = bitcoinjs.buffer.Buffer.from("00000000000000000000120caab7c1caeb4aad6e9dc242e7530d543edd4f6a27","hex");
    block.merkleRoot = bitcoinjs.buffer.Buffer.from("b847ca78b242364926cd5a11469c8b98864ce1af031f5ed3567041a22a8ac2f5","hex");
    block.timestamp = 1619825649;
    block.bits = bitcoinjs.buffer.Buffer.from("170bef93","hex");
    block.nonce = 1334528400;

    let blockhex = block.toHex(true);       // True is headers only
    console.log( "block="+blockhex);


</script>



</body>
</html>